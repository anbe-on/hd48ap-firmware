#include "bongocat.h"

#ifdef OLED_ENABLE

// Simplified BongoCat frames for 128x64 OLED
// This is a basic implementation - you can replace with full bongocat art later
static const char PROGMEM bongocat_idle_frame[] = {
    // Row 0
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    // Row 1 - Simple cat ears
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    // Continue for all 8 rows (512 bytes total for 128x64/8)
};

static const char PROGMEM bongocat_tap_frame[] = {
    // Similar structure but with "tapping" pose
    // For now, same as idle - you can customize later
};

// Animation variables
static bongocat_state_t anim_state = IDLE;
static uint32_t anim_timer = 0;
static uint32_t tap_timer = 0;
static bool is_keyboard_active = false;

void render_bongocat(void) {
    uint8_t current_wpm = get_current_wpm();

    // Update animation state
    if (current_wpm > BONGOCAT_WPM_THRESHOLD) {
        if (!is_keyboard_active) {
            is_keyboard_active = true;
            anim_state = TAP;
            tap_timer = timer_read32();
        }
    } else {
        if (is_keyboard_active && timer_elapsed32(tap_timer) > 2000) {
            is_keyboard_active = false;
            anim_state = IDLE;
        }
    }

    // Simple text-based bongocat for now
    oled_clear();

    // ASCII art bongocat
    switch (anim_state) {
        case IDLE:
            oled_set_cursor(6, 1);
            oled_write_P(PSTR(" /\\_/\\"), false);
            oled_set_cursor(5, 2);
            oled_write_P(PSTR("( o.o )"), false);
            oled_set_cursor(6, 3);
            oled_write_P(PSTR(" > ^ <"), false);
            break;

        case TAP:
            oled_set_cursor(6, 1);
            oled_write_P(PSTR(" /\\_/\\"), false);
            oled_set_cursor(5, 2);
            oled_write_P(PSTR("( ^.^ )"), false);
            oled_set_cursor(4, 3);
            oled_write_P(PSTR("o_)   (_o"), false);
            break;

        default:
            oled_set_cursor(6, 1);
            oled_write_P(PSTR(" /\\_/\\"), false);
            oled_set_cursor(5, 2);
            oled_write_P(PSTR("( -.- )"), false);
            oled_set_cursor(6, 3);
            oled_write_P(PSTR(" > ^ <"), false);
            break;
    }

    // Display WPM and layer info
    oled_set_cursor(0, 5);
    oled_write_P(PSTR("WPM: "), false);
    oled_write(get_u8_str(current_wpm, ' '), false);

    oled_set_cursor(0, 6);
    oled_write_P(PSTR("Layer: "), false);
    oled_write(get_u8_str(get_highest_layer(layer_state), ' '), false);

    // Encoder hint
    oled_set_cursor(0, 7);
    oled_write_P(PSTR("Encoder: Screen"), false);
}

void bongocat_animation_update(void) {
    uint32_t now = timer_read32();

    if (timer_elapsed32(anim_timer) > BONGOCAT_FRAME_DURATION) {
        anim_timer = now;
        // Add frame cycling logic here for more complex animations
    }
}

#endif
